<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>贪吃蛇</title>
</head>
<style type="text/css">
.mod{
	width: 400px;
	height: 400px;
	position: relative;
	background-color: #941;

}

</style>
<body>
	

<div class="mod"></div>






	<script type="text/javascript">
	
	// 对象：蛇，食物，场景
	// 创建对象
	// 	方法：蛇：能动，可以吃食物
	// 		 食物：蛇吃完随机生成

// 构造函数,食物
(function(){
	var elements=[];
	function Food(width,height,color,x,y){
		this.width=width ||20;
		this.height=height||20;
		this.color=color||"green";
		this.x=x;
		this.y=y;
	}
Food.prototype.init=function(mod){
  //创建div
  		remove();
        var div = document.createElement("div");
        //把div加到map中
        mod.appendChild(div);
        div.style.width = this.width + "px";
        div.style.height = this.height + "px";
        div.style.backgroundColor = this.color;
        //先脱离文档流
        div.style.position = "absolute";
	this.x=parseInt(Math.random()*(mod.offsetWidth/this.width))*this.width;
	this.y=parseInt(Math.random()*(mod.offsetWidth/this.height))*this.height;
	 div.style.left = this.x + "px";
        div.style.top = this.y + "px";
        elements.push(div);

		
			 function remove() {
        //elements数组中有这个食物
        for (var i = 0; i < elements.length; i++) {
            var ele = elements[i];
            //找到这个子元素的父级元素,然后删除这个子元素
            ele.parentNode.removeChild(ele);
            //再次把elements中的这个子元素也要删除
            elements.splice(i, 1);
        }
    }}
window.zz=Food;
}());
// 构造函数,蛇
(function(){
	 var elements = [];//存放小蛇的每个身体部分
	 var hh=null;
		
		function Snake(width,height,direction){
			hh=this;
			this.width=width ||20;
			this.height=height||20;
			 this.body=[
			{x: 3, y: 2, color: "red"},//头
            {x: 2, y: 2, color: "orange"},//身体
            {x: 1, y: 2, color: "orange"}//身体
            ];
            this.direction=direction||"right";

		}
		Snake.prototype.init=function(mod){
			remove();
			for (var i=0;i<this.body.length;i++) {
				var obj=this.body[i];
				 var div = document.createElement("div");
				  mod.appendChild(div);
				  //先脱离文档流
        div.style.position = "absolute";
		div.style.width = this.width + "px";
        div.style.height = this.height + "px";
       
          div.style.left = obj.x * this.width + "px";
            div.style.top = obj.y * this.height + "px";
            div.style.backgroundColor = obj.color;
             elements.push(div);
			}
		}
Snake.prototype.move=function(mod){
	
			 var i = this.body.length - 1;//2
        for (; i > 0; i--) {
            this.body[i].x = this.body[i - 1].x;
            this.body[i].y = this.body[i - 1].y;
        }
        switch (this.direction) {
            case "right":
                this.body[0].x += 1;
                break;
            case "left":
                this.body[0].x -= 1;
                break;
            case "top":
                this.body[0].y -= 1;
                break;
            case "bottom":
                this.body[0].y += 1;
                break;
        }
          //横坐标的最大值
            var maxX = mod.offsetWidth / this.width;
            //纵坐标的最大值
            var maxY = mod.offsetHeight / this.height;
            //小蛇的头的坐标
            var headX = this.body[0].x;
            var headY = this.body[0].y;
            //横坐标
            console.log(headX) ;
            if (headX == -2 || headX > maxX) {
                //撞墙了,停止定时器
                clearInterval(timeId);
                alert("游戏结束");
            }
            //纵坐标
            if (headY == -2 || headY > maxY) {
                //撞墙了,停止定时器
                clearInterval(timeId);
                alert("游戏结束");
            }
          

        //获取用户的按键,改变小蛇的方向
        document.addEventListener("keydown",function (e) {
            //这里的this应该是触发keydown的事件的对象---document,
            //所以,这里的this就是document
            //获取按键的值
            switch (e.keyCode){
                case 37:this.direction="left";break;
                case 38:this.direction="top";break;
                case 39:this.direction="right";break;
                case 40:this.direction="bottom";break;
            }
        }.bind(hh),false);
        var headX=this.body[0].x*this.width;
        var headY=this.body[0].y*this.height;
     
        //判断小蛇的头的坐标和食物的坐标是否相同
        if(headX==xx.x&&headY==xx.y){
            //获取小蛇的最后的尾巴
            var last=this.body[this.body.length-1];
            //把最后的蛇尾复制一个,重新的加入到小蛇的body中
            this.body.push({
                x:last.x,
                y:last.y,
                color:last.color
            });
            //把食物删除,重新初始化食物
          xx.init(document.querySelector(".mod"));
        }
    }

 function remove() {
        //删除map中的小蛇的每个div,同时删除elements数组中的每个元素,从蛇尾向蛇头方向删除div
        var i = elements.length - 1;
        for (; i >= 0; i--) {
            //先从当前的子元素中找到该子元素的父级元素,然后再弄死这个子元素
            var ele = elements[i];
            //从map地图上删除这个子元素div
            ele.parentNode.removeChild(ele);
            elements.splice(i, 1);
        }
    }
window.Snake = Snake;
}());
var xx=new zz();

var Snake=new Snake();

var timeId = setInterval(function () {
Snake.init(document.querySelector(".mod"));
Snake.move(document.querySelector(".mod"));
},150)
xx.init(document.querySelector(".mod"));

	</script>
</body>
</html>